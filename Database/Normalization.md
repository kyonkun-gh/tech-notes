# 正規化(Normalization)

- 降低資料**重複性(Data Redundancy)**
- 避免資料**更新異常(Anomalies)**


## 正規化
| 正規化階段    | 要解決的問題          | 規則說明 |
| ------------- | --------------------- | -------- |
| 1NF           | 重複欄位（非原子值）               | 每個欄位必須是**原子值**，不可再拆分；表格需具備主鍵。                                                                 |
| 2NF           | 部分相依                           | 在 **組合主鍵** 情況下，**所有非主鍵欄位**需**完全依賴主鍵**，不可只依賴部分。                                       |
| 3NF           | 傳遞相依                           | **非主鍵欄位不可依賴其他非主鍵欄位**（即不透過其他欄位間接依賴主鍵）。                                               |
| BCNF          | 候選鍵問題                         | 所有**函數決定欄位**都必須是**候選鍵**（即主鍵或具唯一性）。                                                          |
| 4NF           | 多值相依（Multivalued Dependency） | 如果某欄位對主鍵有**多值依賴**，就應分離成不同資料表，消除重複組合。每一筆資料只能描述**一個事實**。                  |
| 5NF（PJNF）   | 聯合相依（Join Dependency）        | 當一張表的資訊能夠被**分解成多張表**，然後**再組合（JOIN）起來完全重建**，就應這樣做。避免多重聯合關係導致資料異常。 |

- **一般實務達到 3NF或 BCNF即可**
- **資料表的主鍵如果由多個欄位組成，則必須執行Boyce-Codd正規化**


## 正規化範例
- 原始資料表（未正規化）

Score 資料表
| 學生編號 | 學生姓名 | 課程資料 | 成績 |
| -------- | -------- | -------- | ---- |
| S001 | 小明  | C001:國文, C002:數學, C003:英文 | 80,90,85 |
| S002 | 小華  | C001:國文, C003:英文            | 75,88    |


- 第一正規化（1NF）: 拆分多值欄位，讓資料具「原子性」

課程資料含有多值，將其拆分出來

Score 資料表
| 學生編號 | 學生姓名 | 課程編號 | 課程名稱 | 分數 |
| -------- | -------- | -------- | -------- | ---- |
| S001     | 小明     | C001     | 國文     | 80   |
| S001     | 小明     | C002     | 數學     | 90   |
| S001     | 小明     | C003     | 英文     | 85   |
| S002     | 小華     | C001     | 國文     | 75   |
| S002     | 小華     | C003     | 英文     | 88   |

- 第二正規化（2NF）: 消除「部分依賴」，以複合主鍵為基礎拆表（學生編號 + 課程編號）

學生姓名 依賴 學生編號，課程名稱 依賴 課程編號，拆出 Student 資料表

Student 資料表
| 學生編號 | 學生姓名 |
| -------- | -------- |
| S001     | 小明     |
| S002     | 小華     |

Score 資料表（保留課程名稱，尚未進 3NF）
| 學生編號 | 課程編號 | 課程名稱 | 分數 |
| -------- | -------- | -------- | ---- |
| S001     | C001     | 國文     | 80   |
| S001     | C002     | 數學     | 90   |
| S001     | C003     | 英文     | 85   |
| S002     | C001     | 國文     | 75   |
| S002     | C003     | 英文     | 88   |

- 第三正規化（3NF）: 消除「傳遞依賴」，是否存在與主鍵無關的相依姓，進一步拆出課程表

課程名稱 僅依賴於 課程編號，不是主鍵的一部分，產生傳遞依賴 → 不符合 3NF

Student 資料表
| 學生編號 | 學生姓名 |
|----------|----------|
| S001     | 小明     |
| S002     | 小華     |

Course 資料表
| 課程編號 | 課程名稱 |
|----------|----------|
| C001     | 國文     |
| C002     | 數學     |
| C003     | 英文     |

Score 資料表
| 學生編號 | 課程編號 | 分數 |
|----------|----------|------|
| S001     | C001     | 80   |
| S001     | C002     | 90   |
| S001     | C003     | 85   |
| S002     | C001     | 75   |
| S002     | C003     | 88   |

